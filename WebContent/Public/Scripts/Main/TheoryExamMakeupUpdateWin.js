Ext.ns("Ynzc");
Ext.ns("Ynzc.manage");
Ynzc.manage.TheoryExamMakeupUpdateWin=Ext.extend(Ext.Window,{
	id:"theoryExamMakeupUpdateWin",
	initComponent:function(){
		Ext.apply(this,{
			id:"theoryExamMakeupUpdateWin",
			title:"理论成绩录入",
			height:550,
			width:550,
			autoScroll:true,
			resizable:false,
			modal:true,
			items:[{
				columnWidth:1,
				frame:true,
				width:'auto',
				items:[{
					title:"学员基本信息",
					xtype:"fieldset",
					layout:"column",
					height:'auto',
					width:500,
					items:[{
						columnWidth:1,
						layout:"form",
						labelWidth:60,
						height:'auto',				        	
						baseCls: "x-plain",
						items:[{
							id:"examinationCode",
							fieldLabel:"报考号",
							readOnly:true,
							xtype:"textfield",
							anchor:'98%'
						}]
					},{
						columnWidth:.5,
						layout:"form",
						labelWidth:60,
						height:'auto',
						baseCls:"x-plain",
						items:[{
							id:"peopleName",
							fieldLabel:"姓名",
							readOnly:true,
							xtype:"textfield",
							anchor:'98%'
						}]
					},{
						columnWidth:.5,
						layout:"form",
						labelWidth:60,
						height:'auto',
						baseCls:"x-plain",
						items:[{
							id:"sex",
							fieldLabel:"性别",
							readOnly:true,
							xtype:"textfield",
							anchor:'98%'
						}]
					},{
						columnWidth:.5,
						layout:"form",
						labelWidth:60,
						height:'auto',
						baseCls:"x-plain",
						items:[{
							id:"idCard",
							fieldLabel:"身份证",
							readOnly:true,
							xtype:"textfield",
							anchor:'98%'
						}]
					},{
						columnWidth:.5,
						layout:"form",
						labelWidth:60,
						height:'auto',
						baseCls:"x-plain",
						items:[{
							id:"address",
							fieldLabel:"地址",
							readOnly:true,
							xtype:"textfield",
							anchor:'98%'
						}]
					},{
						columnWidth:.5,
						layout:"form",
						labelWidth:60,
						height:'auto',
						baseCls:"x-plain",
						items:[{
							id:"drivingLicenceTypeId",
							readOnly:true,
							fieldLabel:"驾驶机型",
							xtype:"textfield",
							anchor:'98%'
						}]
					}]
				},{
					title:"学员考试信息",
					xtype:"fieldset",
					layout:"form",
					height:'auto',
					width:500,
					items:[{
						title:"补考信息",
						xtype:"fieldset",
						layout:"column",
						height:'auto',
						width:'auto',
						bodyStyle:{padding:'5px 5px 5px 5px'},
						items:[{
							columnWidth:.5,
							layout:"form",
							labelWidth:70,
							heigth:'auto',
							baseCls:"x-plain",
							items:[{
								id:"examinerMakeupOne",
								fieldLabel:"补考主考人",
								xtype:"textfield",
								anchor:'98%'
							}]
						},{
							columnWidth:.5,
							layout:"form",
							labelWidth:70,
							heigth:'auto',
							baseCls:"x-plain",
							items:[{
								id:"examinerMakeupTwo",
								fieldLabel:"补考监考人",
								xtype:"textfield",
								anchor:'98%'
							}]
						},{
							columnWidth:.5,
							layout:"form",
							labelWidth:70,
							heigth:'auto',
							baseCls:"x-plain",
							items:[{
								id:"makeupResult",
								fieldLabel:"补考成绩",
								xtype:"textfield",
								anchor:'98%'
							}]
						},{
							columnWidth:.5,
							layout:"form",
							labelWidth:70,
							heigth:'auto',
							baseCls:"x-plain",
							items:[{
								id:"makeupDate",
								fieldLabel:"补考时间",
								xtype:"datefield",
								readOnly:true,
								format:"Y-m-d",
								anchor:'98%'
							}]
						}]
					}]
				},{
					title:"评价信息",
					xtype:"fieldset",
					height:'auto',
					width:500,
					layout:"column",
					bodyStyle:{padding:'5px 5px 5px 5px'},
					items:[{
						columnWidth:.6,
						layout:"form",
						labelWidth:120,
						height:'auto',
						baseCls:"x-plain",
						items:[{
							id:"auditingTheoryIdeaMakeupFlag",
							fieldLabel:"核发学习驾驶证意见",
							xtype:"combo",
							displayField : 'display',
							valueField : 'value',
							typeAhead : true,
							mode : 'local',
							editable:false,
							selectOnFoucs : true,
							triggerAction : 'all',
							store:Ynzc.manage.PassStore,
							emptyText:"请选择核发驾驶证意见",
							anchor:'98%'
						}]
					},{
						columnWidth:.4,
						layout:"form",
						labelWidth:60,
						height:'auto',
						baseCls:"x-plain",
						items:[{
							id:"transactorMakeup",
							fieldLabel:"经办人",
							xtype:"textfield",
							anchor:'98%'
						}]
					},{
						columnWidth:.6,
						layout:"form",
						labelWidth:120,
						height:'auto',
						baseCls:"x-plain",
						items:[{
							id:"unitTheoryAuditingIdeaMakeupFlag",
							fieldLabel:"农机监理部门意见",
							xtype:"combo",
							displayField : 'display',
							valueField : 'value',
							typeAhead : true,
							mode : 'local',
							editable:false,
							selectOnFoucs : true,
							triggerAction : 'all',
							store:Ynzc.manage.PassStore,
							emptyText:"请选择意见",
							anchor:'98%'
						}]
					},{
						columnWidth:.4,
						layout:"form",
						labelWidth:60,
						height:'auto',
						baseCls:"x-plain",
						items:[{
							id:"unitTheoryAuditingIdeaMakeupDate",
							fieldLabel:"填写时间",
							xtype:"datefield",
							readOnly:true,
							format:"Y-m-d",
							anchor:'98%'
						}]
					},{
						columnWidth:.6,
						layout:"form",
						labelWidth:120,
						height:'auto',
						baseCls:"x-plain",
						items:[{
							id:"auditingTheoryResultFlag",
							fieldLabel:"结论",
							xtype:"combo",
							displayField : 'display',
							valueField : 'value',
							typeAhead : true,
							mode : 'local',
							editable:false,
							selectOnFoucs : true,
							triggerAction : 'all',
							store:Ynzc.manage.EligibilityOrUnEligibilityStore,
							emptyText:"请选择结论",
							anchor:'98%',
							listeners:{
								"select":function(){
									if(this.value === 0){
										Ext.getCmp("unitTheoryAuditingIdeaMakeupFlag").setValue(0);
										Ext.getCmp("auditingTheoryIdeaMakeupFlag").setValue(0);
									}
									if(this.value === 1){
										Ext.getCmp("unitTheoryAuditingIdeaMakeupFlag").setValue(1);
										Ext.getCmp("auditingTheoryIdeaMakeupFlag").setValue(1);
									}
								}
							}
						}]
					}]
				}]				
			}],
			buttons:[{
				id:"savaBtn",
				text:"保存",
				handler:function(){
					if(checkNum(Ext.getCmp("makeupResult").getValue())){
						Ext.MessageBox.alert("提示","成绩填写有误!");
						initFocus('theoryResult');
						return;
					}
					if(checkLen(Ext.getCmp("examinerMakeupOne").getValue())){
						Ext.MessageBox.alert("提示","主考人填写有误!");
						initFocus('examinerOne');
						return;
					}
					if(checkLen(Ext.getCmp("examinerMakeupTwo").getValue())){
						Ext.MessageBox.alert("提示","监考人填写有误!");
						initFocus('examinerTwo');
						return;
					}
					if(Ext.getCmp("makeupDate").getValue()==""){
						Ext.MessageBox.alert("提示","请填写时间!");
						return;
					}
					if(Ext.getCmp("auditingTheoryIdeaFlag").getValue()===""){
						Ext.MessageBox.alert("提示","请填选择核发学习驾驶证意见!");
						return;
					}
					if(Ext.getCmp("unitTheoryAuditingIdeaFlag").getValue()===""){
						Ext.MessageBox.alert("提示","请填选择地、（州、市）农机监理部门意见!");
						return;
					}
					if(Ext.getCmp("unitTheoryAuditingIdeaDate").getValue()==""){
						Ext.MessageBox.alert("提示","请填写地、（州、市）农机监理部门意见填写时间!");
						return;
					}
					if(Ext.getCmp("auditingTheoryResultFlag").getValue()===""){
						Ext.MessageBox.alert("提示","请填选择结论!");
						return;
					}
					if(Ext.getCmp("makeupResult").getValue()<0 || Ext.getCmp("makeupResult").getValue()>100){
						Ext.MessageBox.alert("提示","成绩填写有误!");
						initFocus('makeupResult');
						return;
					}
					if(Ext.getCmp("auditingTheoryIdeaMakeupFlag").getValue() === 1){
						if(Ext.getCmp("makeupResult").getValue()<85){
							Ext.MessageBox.alert("提示","成绩填写有误!");
							initFocus('makeupResult');
							return;
						}
					}
					if(Ext.getCmp("auditingTheoryIdeaMakeupFlag").getValue() === 1){
						if(Ext.getCmp("auditingTheoryIdeaMakeupFlag").getValue() === 0){
							Ext.MessageBox.alert("提示","核发学习驾驶证意见选择有误不予通过保存!");
							initFocus('auditingTheoryIdeaMakeupFlag');
							return;
						}
						if(Ext.getCmp("unitTheoryAuditingIdeaMakeupFlag").getValue() === 0){
							Ext.MessageBox.alert("提示","地、（州、市）农机监理部门意见选择有误不予通过保存!");
							initFocus('unitTheoryAuditingIdeaMakeupFlag');
							return;
						}
					}
					var mask = new Ext.LoadMask(Ext.getBody(), {
			     		msg : '正在處理数据,请稍等...',
			     		removeMask:true
	                });
					Ext.Ajax.request({
						url:"main/theoryExam.html?action=addTheoryExam",
						success:function(resp){
						mask.hide();
							var result=Ext.util.JSON.decode(resp.responseText);
							if(result.success==true){
								Ext.MessageBox.alert("提示",result.reason);
								Ext.getCmp("dirverClassStrExamGrid").getStore().reload();
								Ext.getCmp("theoryExamMakeupUpdateWin").close();
							}else{
								Ext.Msg.alert("提示",result.reason);
							}
						},
						failure:function(){
							Ext.Msg.alert("警告","<font color=red>与服务器通讯失败!</font>");
						},
						params:{
							theoryId:Ynzc.manage.TheoryId,
							classInfoId:Ynzc.manage.DriverClassInfoId,
							makeupResult:Ext.getCmp("makeupResult").getValue(),
							examinerMakeupOne:Ext.getCmp("examinerMakeupOne").getValue(),
							examinerMakeupTwo:Ext.getCmp("examinerMakeupTwo").getValue(),
							makeupDate:Ext.util.Format.date(Ext.getCmp("makeupDate").getValue(),'Y-m-d'),
							auditingTheoryIdeaMakeupFlag:Ext.getCmp("auditingTheoryIdeaMakeupFlag").getValue(),
							transactorMakeup:Ext.getCmp("transactorMakeup").getValue(),
							unitTheoryAuditingIdeaMakeupFlag:Ext.getCmp("unitTheoryAuditingIdeaMakeupFlag").getValue(),
							unitTheoryAuditingIdeaMakeupDate:Ext.util.Format.date(Ext.getCmp("unitTheoryAuditingIdeaMakeupDate").getValue(),'Y-m-d'),
							auditingTheoryResultMakeupFlag:Ext.getCmp("auditingTheoryResultMakeupFlag").getValue()
						}
					});
				}
			},{
				id:"cancelBtn",
				text:"取消",
				handler:function(){
					Ext.getCmp("theoryExamMakeupUpdateWin").close();
				}
			}]
		});
		Ynzc.manage.TheoryExamMakeupUpdateWin.superclass.initComponent.apply(this,arguments);
	}
});