Ext.ns("Ynzc");
Ext.ns("Ynzc.manage");
Ynzc.manage.DrivingLicenceMakeWorkWin=Ext.extend(Ext.Window,{
	id:"drivingLicenceMakeWorkWin",
	initComponent:function(){
		Ext.apply(this,{
			id:"drivingLicenceMakeWorkWin",
			title:"违规记录",
			autoHeight:true,
			width:300,
			autoScroll:true,
			resizable:false,
			modal:true,
			items:[{
				frame:true,
				items:[{
					layout:"form",
					labelWidth:60,
					items:[{
						layout:"form",
						items:[{
							id:"peccancyDate",
							fieldLabel:"违章时间",
 							xtype:"datefield",
							format:"Y-m-d",
							anchor:'98%'
						}]
					},{
						layout:"form",
						items:[{
							id:"penaltyNo",
							fieldLabel:"罚单编号",
							xtype:"textfield",
							anchor:'98%'
						}]
					},{
						layout:"form",
						items:[{
							id:"markRecoup",
							fieldLabel:"扣除数分",
							xtype:"textfield",
							anchor:'98%'
						}]
					},{
						layout:"form",
						items:[{
							id:"tipstaff",
							fieldLabel:"执法人员",
							xtype:"textfield",
							anchor:'98%'
						}]
					},{
						layout:"form",
						items:[{
							id:"transactor",
							fieldLabel:"经办人",
							xtype:"textfield",
							anchor:'98%'
						}]
					},{
						layout:"form",
						items:[{
							id:"transactorDate",
							fieldLabel:"经办时间",
							xtype:"datefield",
							format:"Y-m-d",
							anchor:'98%'
						}]
					}]
				}]
			}],
			buttons:[{
				id:"savaBtn",
				text:"保存",
				handler:function(){
					if(Ext.getCmp("peccancyDate").getValue()==""){
						Ext.MessageBox.alert("提示","请填写违章时间!");
						return;
					}
					if(Ext.getCmp("penaltyNo").getValue()==""){
						Ext.MessageBox.alert("提示","请填写罚单编号!");
						return;
					}
					if(Ext.getCmp("mark").getValue()==""){
						Ext.MessageBox.alert("提示","请填写扣除数分!");
						return;
					}
					if(Ext.getCmp("tipstaff").getValue()==""){
						Ext.MessageBox.alert("提示","请填写执法人员!");
						return;
					}
					if(Ext.getCmp("transactor").getValue()==""){
						Ext.MessageBox.alert("提示","请填写经办人!");
						return;
					}
					if(Ext.getCmp("transactorDate").getValue()==""){
						Ext.MessageBox.alert("提示","请填写经办时间!");
						return;
					}
	                var mask = new Ext.LoadMask(Ext.getBody(), {
			     		msg : '正在录入数据,请稍等...',
			     		removeMask:true
	                });
	                mask.show();
					Ext.Ajax.request({
						url:"main/driverMark.html?action=addDriverMark",
						success:function(resp){
							mask.hide();
							var result=Ext.util.JSON.decode(resp.responseText);
							if(result.success==true){
								if(result.success==true){
									Ext.MessageBox.alert("提示",result.reason);
									Ext.getCmp("mark").setValue(Ext.getCmp("mark").getValue()-Ext.getCmp("markRecoup").getValue());
									if(Ext.getCmp("mark").getValue()<0){
										Ext.getCmp("userState").setValue("不可用");
									}
									Ext.getCmp("dirvingLicenceMakeGrid").getStore().reload();
									Ext.getCmp("driverLicenceMgr").getStore().reload();
									Ext.getCmp("drivingLicenceMakeWorkWin").close();
								}else{
									Ext.MessageBox.alert("提示",result.reason);
								}
							}else{
								Ext.MessageBox.alert("提示",result.reason);
							}
						},
						failure:function(){
							Ext.Msg.alert("警告","<font color=red>与服务器通讯失败!</font>");
						},
						params:{
							drivingLicenceId:Ynzc.manage.drivingLicenceId,
							peccancyDate:Ext.util.Format.date(Ext.getCmp("peccancyDate").getValue(),'Y-m-d'),
							penaltyNo:Ext.getCmp("penaltyNo").getValue(),
							mark:Ext.getCmp("markRecoup").getValue(),
							tipstaff:Ext.getCmp("tipstaff").getValue(),
							transactor:Ext.getCmp("transactor").getValue(),
							transactorDate:Ext.util.Format.date(Ext.getCmp("transactorDate").getValue(),'Y-m-d')
						}
					});
				}
			},{
				id:"cancelBtn",
				text:"取消",
				handler:function(){
					Ext.getCmp("drivingLicenceMakeWorkWin").close();
				}
			}]
		});
		Ynzc.manage.DrivingLicenceMakeWorkWin.superclass.initComponent.apply(this,arguments);
	}
});
